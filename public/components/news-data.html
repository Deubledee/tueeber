<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="news-search.html">
<dom-module id="news-data">
  <script>

    (function () {

      let categoryList = [
        { name: 'General', title: 'General', lang: ['en'], sources: ['google-news', 'fox-news', 'cbs-news', 'nbc-news', 'reuters', 'politico', 'the-washington-post'] },
        { name: 'Sports', title: 'Sports',lang: ['en'], sources: ['espn', 'nhl-news', 'the-sport-bible', 'bbc-sport', 'fox-sports', 'four-four-two', 'talksport'] },
        { name: 'Entertainment', title: 'Entertainment', lang: ['en'], sources: ['mtv-news', 'mtv-news-uk', 'entertainment-weekly', 'mashable', 'buzzfeed', 'the-lad-bible', 'polygon'] },
        { name: 'Technology', title: 'Technology', lang: ['en'], sources: ['engadget', 'wired', 'techcrunch', 'hacker-news', 'the-verge', 'techradar'] },
        { name: 'Business&Finance', title: 'Business & Finance', sources: ['cnbc','Bloomberg','the-wall-street-journal','the-economist','business-insider','financial-times', 'the-economist']}
      ];

      let textarea = document.createElement('textarea');

      class NewsData extends Polymer.Element {

        static get is() { return 'news-data'; }

        static get properties() {
          return {

            categories: {
              type: Array,
              value: categoryList,
              readOnly: true,
              notify: true
            },

            categoryName: String,

            articleId: String,

            offline: Boolean,

            loading: {
              type: Boolean,
              readOnly: true,
              notify: true
            },
            search: {
              type: Boolean,
              value: false,
              notify: true
            },
            category: {
              type: Object,
              computed: '_computeCategory(categoryName)',
              // observer: '_log',
              notify: true
            },
            previous: {
              type: Object
            },
            failure: {
              type: Boolean,
              readOnly: true,
              notify: true
            },
            time: {
              type: Object,
              notify: true,
              value: function () {
                return {
                  method: "topHeadlines",
                  api: "topHeadlines",
                  sources: '',
                  q: '',
                  category: '',
                  language: 'en',
                  country: ''
                }
              }
            },
            topheadlines: {
              type: Object,
              value: function () {
                let d = new Date()
                let year = d.toLocaleDateString().split('/')
                let fultime = year.pop()
                fultime = fultime + '/' + year.join('/')
                return {
                  method: "everything",
                  api: "everything",
                  sources: 'google-news',
                  domains: '',
                  q: '',
                  from: '',
                  to: '',
                  language: 'en',
                  sortBy: 'publishedAt',
                  page: '10'
                }
              }
            },
            sports: {
              type: Object,
              observedr: '_log',
              value: function () {
                let d = new Date()
                let year = d.toLocaleDateString().split('/')
                let fultime = year.pop()
                fultime = fultime + '/' + year.join('/')
                return {
                  method: "everything",
                  api: "everything",
                  sources: 'time',
                  domains: '',
                  q: '',
                  from: '',
                  to: '',
                  language: 'en',
                  sortBy: 'publishedAt',
                  page: '10'
                }
              }
            },
            bbcNews: {
              type: Object,
              value: function () {
                let d = new Date()
                let year = d.toLocaleDateString().split('/')
                let fultime = year.pop()
                fultime = fultime + '/' + year.join('/')
                return {
                  method: "everything",
                  api: "everything",
                  sources: 'bbc-news',
                  domains: '',
                  q: '',
                  from: '',
                  to: '',
                  language: 'en',
                  sortBy: 'publishedAt',
                  page: '10'
                }
              }
            }

          }
        }

        static get observers() {
          return [
          ]
        }
        _log(data) {
          console.log('log', data)
        }

        _computeCategory(categoryName) {
          // console.log(categoryName, this.categories)
          for (let i = 0, c; c = this.categories[i]; ++i) {
            if (c.name === categoryName) {
              this.previous = c
              return c;
            }
          }
          return this.previous || this.categories[0];
        }


        _trimRight(text, maxLength) {
          let breakIdx = text.indexOf(' ', maxLength);
          return breakIdx === -1 ? text : text.substr(0, breakIdx) + '...';
        }

        refresh() {
          if (this.categoryName) {
            // Try at most 3 times to get the items.
            this._fetchCategory(this.category, this.offline, 3);
          }
        }

      }

      customElements.define(NewsData.is, NewsData);

    })();

  </script>

</dom-module>